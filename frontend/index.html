<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C·ª≠a H√†ng Online - Full Stack</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">

    <nav class="bg-blue-600 text-white p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold cursor-pointer" onclick="showSection('home')">üõí Simple Shop</h1>
            <div id="nav-buttons"></div>
        </div>
    </nav>

    <main class="container mx-auto p-4 mt-4">

        <div id="section-home" class="block">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-gray-800">S·∫£n Ph·∫©m M·ªõi</h2>
                <button id="btn-add-product" onclick="showSection('add-product')" class="hidden bg-green-50 hover:bg-green-600 text-white px-4 py-2 rounded">
                    + Th√™m (Admin)
                </button>
            </div>
            <div id="product-list" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <p class="text-gray-500">ƒêang t·∫£i...</p>
            </div>
            
            <!-- Gi·ªè h√†ng nhanh -->
            <div id="quick-cart" class="mt-6 p-4 bg-white rounded shadow hidden">
                <h3 class="text-xl font-bold mb-3">üõí Gi·ªè H√†ng</h3>
                <div id="quick-cart-items"></div>
                <div class="flex justify-between items-center mt-3">
                    <span class="font-bold">T·ªïng: <span id="quick-cart-total">$0.00</span></span>
                    <button onclick="showSection('cart')" class="bg-blue-500 text-white px-4 py-2 rounded">Xem Gi·ªè H√†ng</button>
                </div>
            </div>
            
            <!-- Danh s√°ch y√™u th√≠ch nhanh -->
            <div id="quick-wishlist" class="mt-6 p-4 bg-white rounded shadow hidden">
                <h3 class="text-xl font-bold mb-3">‚ù§Ô∏è Y√™u Th√≠ch</h3>
                <div id="quick-wishlist-items"></div>
            </div>
        </div>

        <!-- Trang gi·ªè h√†ng -->
        <div id="section-cart" class="hidden">
            <h2 class="text-3xl font-bold text-gray-80 mb-6">üõí Gi·ªè H√†ng C·ªßa B·∫°n</h2>
            <div class="bg-white p-6 rounded shadow">
                <div id="cart-items" class="mb-6">
                    <p class="text-gray-500">ƒêang t·∫£i gi·ªè h√†ng...</p>
                </div>
                <div class="flex justify-between items-center mb-6">
                    <span class="text-2xl font-bold">T·ªïng c·ªông: <span id="cart-total">$0.00</span></span>
                </div>
                <div class="flex gap-3">
                    <button onclick="showSection('home')" class="bg-gray-300 text-gray-700 px-6 py-3 rounded">Ti·∫øp t·ª•c mua s·∫Øm</button>
                    <button onclick="showSection('checkout')" class="bg-green-500 text-white px-6 py-3 rounded ml-auto">Thanh to√°n</button>
                </div>
            </div>
        </div>

        <!-- Trang thanh to√°n -->
        <div id="section-checkout" class="hidden max-w-2xl mx-auto">
            <h2 class="text-3xl font-bold text-gray-80 mb-6">üí≥ Thanh To√°n</h2>
            <div class="bg-white p-6 rounded shadow">
                <div class="mb-6">
                    <h3 class="text-xl font-bold mb-3">Th√¥ng tin giao h√†ng</h3>
                    <div class="mb-4">
                        <label class="block mb-2">ƒê·ªãa ch·ªâ giao h√†ng</label>
                        <input type="text" id="shipping-address" class="w-full p-2 border rounded" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ giao h√†ng" required>
                    </div>
                
                <div class="mb-6">
                    <h3 class="text-xl font-bold mb-3">Gi·ªè h√†ng</h3>
                    <div id="checkout-cart-items"></div>
                    <div class="flex justify-between items-center mt-4 pt-4 border-t">
                        <span class="text-xl font-bold">T·ªïng c·ªông:</span>
                        <span class="text-xl font-bold" id="checkout-total">$0.00</span>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h3 class="text-xl font-bold mb-3">Ph∆∞∆°ng th·ª©c thanh to√°n</h3>
                    <div class="border p-4 rounded">
                        <p>Thanh to√°n qua Stripe (m√¥ ph·ªèng)</p>
                    </div>
                </div>
                
                <button onclick="processCheckout()" class="w-full bg-green-600 text-white py-3 rounded text-xl">X√°c nh·∫≠n thanh to√°n</button>
                <button onclick="showSection('cart')" class="w-full mt-2 bg-gray-300 text-gray-700 py-2 rounded">Quay l·∫°i gi·ªè h√†ng</button>
            </div>
        </div>

        <!-- Trang l·ªãch s·ª≠ ƒë∆°n h√†ng -->
        <div id="section-orders" class="hidden">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">üì¶ L·ªãch S·ª≠ ƒê∆°n H√†ng</h2>
            <div id="orders-list" class="bg-white p-6 rounded shadow">
                <p class="text-gray-500">ƒêang t·∫£i l·ªãch s·ª≠ ƒë∆°n h√†ng...</p>
            </div>
        </div>

        <div id="section-login" class="hidden max-w-md mx-auto bg-white p-8 rounded shadow-md mt-10">
            <h2 class="text-2xl font-bold mb-6 text-center">ƒêƒÉng Nh·∫≠p</h2>
            <form onsubmit="handleLogin(event)">
                <div class="mb-4">
                    <label class="block mb-2">T√™n ƒëƒÉng nh·∫≠p</label>
                    <input type="text" id="login-username" class="w-full p-2 border rounded" required>
                </div>
                <div class="mb-6">
                    <label class="block mb-2">M·∫≠t kh·∫©u</label>
                    <input type="password" id="login-password" class="w-full p-2 border rounded" required>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">ƒêƒÉng Nh·∫≠p</button>
            </form>
            <p class="mt-4 text-center">Ch∆∞a c√≥ t√†i kho·∫£n? <a href="#" onclick="showSection('register')" class="text-blue-500">ƒêƒÉng k√Ω ngay</a></p>
        </div>

        <div id="section-register" class="hidden max-w-md mx-auto bg-white p-8 rounded shadow-md mt-10">
            <h2 class="text-2xl font-bold mb-6 text-center">ƒêƒÉng K√Ω T√†i Kho·∫£n</h2>
            <form onsubmit="handleRegister(event)">
                <div class="mb-3">
                    <label class="block mb-1 text-sm font-bold">T√™n ng∆∞·ªùi d√πng</label>
                    <input type="text" id="reg-username" class="w-full p-2 border rounded" required placeholder="V√≠ d·ª•: baoanh123">
                </div>
                
                <div class="mb-3">
                    <label class="block mb-1 text-sm font-bold">M·∫≠t kh·∫©u</label>
                    <input type="password" id="reg-password" class="w-full p-2 border rounded" required>
                </div>

                <div class="mb-3">
                    <label class="block mb-1 text-sm font-bold">Nh·∫≠p l·∫°i m·∫≠t kh·∫©u</label>
                    <input type="password" id="reg-confirm-pass" class="w-full p-2 border rounded" required>
                    <p id="pass-error" class="text-red-500 text-xs mt-1 hidden">M·∫≠t kh·∫©u kh√¥ng kh·ªõp!</p>
                </div>

                <div class="mb-3">
                    <label class="block mb-1 text-sm font-bold">S·ªë ƒëi·ªán tho·∫°i</label>
                    <input type="text" id="reg-phone" class="w-full p-2 border rounded" required placeholder="09xxxxxxxx">
                </div>

                <div class="mb-6">
                    <label class="block mb-1 text-sm font-bold">ƒê·ªãa ch·ªâ Email</label>
                    <input type="email" id="reg-email" class="w-full p-2 border rounded" required placeholder="abc@gmail.com">
                </div>

                <button type="submit" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600">ƒêƒÉng K√Ω Th√†nh Vi√™n</button>
            </form>
            <p class="mt-4 text-center">ƒê√£ c√≥ t√†i kho·∫£n? <a href="#" onclick="showSection('login')" class="text-blue-500">ƒêƒÉng nh·∫≠p</a></p>
        </div>

        <div id="section-add-product" class="hidden max-w-md mx-auto bg-white p-8 rounded shadow-md mt-10">
            <h2 class="text-2xl font-bold mb-6 text-center">Th√™m S·∫£n Ph·∫©m M·ªõi</h2>
            <form onsubmit="handleAddProduct(event)">
                <div class="mb-4">
                    <label class="block mb-2">T√™n s·∫£n ph·∫©m</label>
                    <input type="text" id="prod-name" class="w-full p-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label class="block mb-2">Gi√° ($)</label>
                    <input type="number" id="prod-price" class="w-full p-2 border rounded" required>
                </div>
                <div class="mb-6">
                    <label class="block mb-2">M√¥ t·∫£</label>
                    <textarea id="prod-desc" class="w-full p-2 border rounded"></textarea>
                </div>
                <button type="submit" class="w-full bg-purple-600 text-white py-2 rounded hover:bg-purple-70">L∆∞u S·∫£n Ph·∫©m</button>
                <button type="button" onclick="showSection('home')" class="w-full mt-2 bg-gray-300 text-gray-700 py-2 rounded">H·ªßy</button>
            </form>
        </div>

    </main>

    <script>
        // --- THAY LINK C·ª¶A B·∫†N V√ÄO ƒê√ÇY ---
        const API_URL = "https://cuahangonline.onrender.com"; 

        let currentUser = null;
        let token = localStorage.getItem('access_token');

        document.addEventListener('DOMContentLoaded', () => {
            checkLoginStatus();
            loadProducts();
        });

        // --- LOGIC ƒêƒÇNG K√ù M·ªöI ---
        async function handleRegister(e) {
            e.preventDefault();
            const username = document.getElementById('reg-username').value;
            const password = document.getElementById('reg-password').value;
            const confirmPass = document.getElementById('reg-confirm-pass').value;
            const phone = document.getElementById('reg-phone').value;
            const email = document.getElementById('reg-email').value;

            // Ki·ªÉm tra m·∫≠t kh·∫©u nh·∫≠p l·∫°i
            if (password !== confirmPass) {
                document.getElementById('pass-error').classList.remove('hidden');
                return;
            } else {
                document.getElementById('pass-error').classList.add('hidden');
            }

            try {
                // G·ª≠i d·ªØ li·ªáu l√™n Backend
                await axios.post(`${API_URL}/register`, { 
                    username, 
                    password, 
                    phone, 
                    email 
                });
                alert("ƒêƒÉng k√Ω th√†nh c√¥ng! B·∫°n ƒë√£ l√† Th√†nh vi√™n.");
                showSection('login');
            } catch (error) {
                alert("ƒêƒÉng k√Ω th·∫•t b·∫°i: " + (error.response?.data?.detail || "L·ªói server"));
            }
        }

        // --- C√ÅC H√ÄM C≈® GI·ªÆ NGUY√äN ---
        async function checkLoginStatus() {
            token = localStorage.getItem('access_token');
            const navButtons = document.getElementById('nav-buttons');
            const btnAddProduct = document.getElementById('btn-add-product');

            if (token) {
                try {
                    const response = await axios.get(`${API_URL}/users/me`, {
                        headers: { Authorization: `Bearer ${token}` }
                    });
                    currentUser = response.data;

                    navButtons.innerHTML = `
                        <div class="flex items-center space-x-4">
                            <button onclick="showSection('orders')" class="text-sm hover:underline">ƒê∆°n h√†ng</button>
                            <div class="text-right">
                                <span class="block text-sm">Xin ch√†o, <b>${currentUser.username}</b></span>
                                <button onclick="logout()" class="text-red-200 text-xs hover:text-white">ƒêƒÉng xu·∫•t</button>
                            </div>
                        </div>
                    `;

                    if (currentUser.role === 'admin') {
                        btnAddProduct.classList.remove('hidden');
                    } else {
                        btnAddProduct.classList.add('hidden');
                    }

                } catch (error) {
                    logout();
                }
            } else {
                navButtons.innerHTML = `
                    <button onclick="showSection('login')" class="bg-white text-blue-600 px-4 py-2 rounded font-semibold mr-2">ƒêƒÉng Nh·∫≠p</button>
                    <button onclick="showSection('register')" class="border border-white px-4 py-2 rounded font-semibold hover:bg-blue-700">ƒêƒÉng K√Ω</button>
                `;
                btnAddProduct.classList.add('hidden');
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const formData = new URLSearchParams();
            formData.append('username', username);
            formData.append('password', password);

            try {
                const response = await axios.post(`${API_URL}/token`, formData);
                localStorage.setItem('access_token', response.data.access_token);
                alert("ƒêƒÉng nh·∫≠p th√†nh c√¥ng!");
                showSection('home');
                checkLoginStatus();
            } catch (error) {
                alert("Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!");
            }
        }

        function logout() {
            localStorage.removeItem('access_token');
            currentUser = null;
            location.reload();
        }

        async function loadProducts() {
                    try {
                        const response = await axios.get(`${API_URL}/products`);
                        const list = document.getElementById('product-list');
                        list.innerHTML = '';
        
                        for (const p of response.data) {
                            // L·∫•y ƒë√°nh gi√° trung b√¨nh cho s·∫£n ph·∫©m
                            let avgRating = 0;
                            let ratingCount = 0;
                            try {
                                const reviewsResponse = await axios.get(`${API_URL}/products/${p.id}/reviews`);
                                const reviews = reviewsResponse.data;
                                if (reviews.length > 0) {
                                    avgRating = reviews.reduce((sum, review) => sum + review.rating, 0) / reviews.length;
                                    ratingCount = reviews.length;
                                }
                            } catch (error) {
                                console.error("L·ªói khi t·∫£i ƒë√°nh gi√°:", error);
                            }
        
                            const deleteBtn = (currentUser && currentUser.role === 'admin')
                                ? `<button onclick="deleteProduct(${p.id})" class="text-red-500 text-sm mt-2 underline">X√≥a</button>`
                                : '';
                            
                            const addToCartBtn = `<button onclick="addToCart(${p.id}, '${p.name.replace(/'/g, "\\'")}', ${p.price})" class="text-blue-500 text-sm mt-2 underline">Th√™m v√†o gi·ªè</button>`;
                            const addToWishlistBtn = `<button onclick="addToWishlist(${p.id}, '${p.name.replace(/'/g, "\\'")}', ${p.price})" class="text-red-500 text-sm mt-2 underline">Y√™u th√≠ch</button>`;
        
                            // T·∫°o hi·ªÉn th·ªã sao ƒë√°nh gi√°
                            let starsHtml = '';
                            for (let i = 1; i <= 5; i++) {
                                if (i <= Math.floor(avgRating)) {
                                    starsHtml += '‚òÖ'; // Sao ƒë·∫ßy
                                } else if (i === Math.ceil(avgRating) && avgRating % 1 !== 0) {
                                    starsHtml += '‚òÜ'; // Sao n·ª≠a
                                } else {
                                    starsHtml += '‚òÜ'; // Sao tr·ªëng
                                }
                            }
        
                            list.innerHTML += `
                                <div class="bg-white p-4 rounded shadow hover:shadow-lg transition">
                                    <div class="h-40 bg-gray-200 flex items-center justify-center text-4xl mb-4">üì¶</div>
                                    <h3 class="font-bold text-lg">${p.name}</h3>
                                    <p class="text-gray-600 text-sm">${p.description}</p>
                                    <div class="mt-2">
                                        <span class="text-yellow-500">${starsHtml}</span>
                                        <span class="text-xs text-gray-500">(${ratingCount} ƒë√°nh gi√°)</span>
                                    </div>
                                    <div class="flex justify-between items-center mt-4">
                                        <span class="text-blue-600 font-bold">$${p.price}</span>
                                        <div class="flex space-x-2">
                                            ${addToCartBtn}
                                            ${addToWishlistBtn}
                                            ${deleteBtn}
                                        </div>
                                    </div>
                                </div>
                            `;
                        }
                        
                        // C·∫≠p nh·∫≠t gi·ªè h√†ng nhanh n·∫øu ƒëang ƒëƒÉng nh·∫≠p
                        if (token) {
                            loadCart();
                            loadWishlist();
                        }
                    } catch (error) {
                        console.error(error);
                    }
                }

        async function handleAddProduct(e) {
            e.preventDefault();
            const name = document.getElementById('prod-name').value;
            const price = document.getElementById('prod-price').value;
            const desc = document.getElementById('prod-desc').value;
            try {
                await axios.post(`${API_URL}/products`, {
                    name, price: parseFloat(price), description: desc
                }, { headers: { Authorization: `Bearer ${token}` } });
                alert("Th√™m s·∫£n ph·∫©m th√†nh c√¥ng!");
                showSection('home');
                loadProducts();
            } catch (error) { alert("L·ªói: B·∫°n kh√¥ng c√≥ quy·ªÅn Admin!"); }
        }

        async function deleteProduct(id) {
            if (!confirm("X√≥a nh√©?")) return;
            try {
                await axios.delete(`${API_URL}/products/${id}`, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                loadProducts();
            } catch (error) { alert("L·ªói!"); }
        }

        function showSection(sectionId) {
            ['home', 'login', 'register', 'add-product', 'cart', 'checkout', 'orders'].forEach(id => {
                document.getElementById(`section-${id}`).classList.add('hidden');
            });
            document.getElementById(`section-${id}`).classList.remove('hidden');
            if (sectionId === 'home') loadProducts();
            if (sectionId === 'cart') loadCart();
            if (sectionId === 'orders') loadOrders();
        }

        // --- GI·ªé H√ÄNG ---
        async function loadCart() {
            if (!token) {
                alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem gi·ªè h√†ng");
                showSection('login');
                return;
            }
            
            try {
                const response = await axios.get(`${API_URL}/cart`, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                
                const cartItems = document.getElementById('cart-items');
                const cartTotal = document.getElementById('cart-total');
                
                if (response.data.items.length === 0) {
                    cartItems.innerHTML = '<p class="text-gray-500">Gi·ªè h√†ng tr·ªëng</p>';
                    cartTotal.textContent = '$0.0';
                    document.getElementById('quick-cart').classList.add('hidden');
                    return;
                }
                
                let html = '<div class="space-y-4">';
                let total = 0;
                
                response.data.items.forEach(item => {
                    const itemTotal = item.product_price * item.quantity;
                    total += itemTotal;
                    
                    html += `
                        <div class="flex items-center justify-between border-b pb-4">
                            <div class="flex items-center">
                                <div class="h-16 w-16 bg-gray-200 rounded mr-4 flex items-center justify-center text-2xl">üì¶</div>
                                <div>
                                    <h4 class="font-bold">${item.product_name}</h4>
                                    <p class="text-gray-600">$${item.product_price} x ${item.quantity}</p>
                                </div>
                            <div class="flex items-center">
                                <span class="font-bold mr-4">$${itemTotal.toFixed(2)}</span>
                                <button onclick="removeFromCart(${item.id})" class="text-red-500 hover:text-red-700">X√≥a</button>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                cartItems.innerHTML = html;
                cartTotal.textContent = `$${total.toFixed(2)}`;
                
                // C·∫≠p nh·∫≠t gi·ªè h√†ng nhanh
                updateQuickCart(response.data.items, total);
                
            } catch (error) {
                console.error("L·ªói khi t·∫£i gi·ªè h√†ng:", error);
            }
        }

        async function addToCart(productId, productName, productPrice) {
            if (!token) {
                alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng");
                showSection('login');
                return;
            }
            
            try {
                await axios.post(`${API_URL}/cart`, {
                    product_id: productId,
                    quantity: 1
                }, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                
                // C·∫≠p nh·∫≠t gi·ªè h√†ng nhanh
                await loadCart();
                alert("ƒê√£ th√™m v√†o gi·ªè h√†ng!");
            } catch (error) {
                console.error("L·ªói khi th√™m v√†o gi·ªè h√†ng:", error);
                alert("L·ªói khi th√™m v√†o gi·ªè h√†ng");
            }
        }

        async function removeFromCart(itemId) {
            if (!token) {
                alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ th·ª±c hi·ªán thao t√°c n√†y");
                showSection('login');
                return;
            }
            
            try {
                await axios.delete(`${API_URL}/cart/${itemId}`, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                
                await loadCart();
            } catch (error) {
                console.error("L·ªói khi x√≥a kh·ªèi gi·ªè h√†ng:", error);
                alert("L·ªói khi x√≥a kh·ªèi gi·ªè h√†ng");
            }
        }

        async function updateQuickCart(items, total) {
            const quickCartItems = document.getElementById('quick-cart-items');
            const quickCartTotal = document.getElementById('quick-cart-total');
            
            if (items.length === 0) {
                document.getElementById('quick-cart').classList.add('hidden');
                return;
            }
            
            let html = '<div class="space-y-2">';
            items.forEach(item => {
                html += `
                    <div class="flex justify-between text-sm">
                        <span>${item.product_name} x ${item.quantity}</span>
                        <span>$${(item.product_price * item.quantity).toFixed(2)}</span>
                    </div>
                `;
            });
            html += '</div>';
            
            quickCartItems.innerHTML = html;
            quickCartTotal.textContent = `$${total.toFixed(2)}`;
            document.getElementById('quick-cart').classList.remove('hidden');
        }

        // --- THANH TO√ÅN ---
        async function processCheckout() {
            if (!token) {
                alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ thanh to√°n");
                showSection('login');
                return;
            }
            
            const shippingAddress = document.getElementById('shipping-address').value;
            if (!shippingAddress) {
                alert("Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ giao h√†ng");
                return;
            }
            
            try {
                // T·∫°o ƒë∆°n h√†ng
                const orderResponse = await axios.post(`${API_URL}/orders`, {
                    shipping_address: shippingAddress
                }, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                
                // T·∫°o payment intent
                const cartResponse = await axios.get(`${API_URL}/cart`, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                
                const totalAmount = cartResponse.data.total;
                const paymentResponse = await axios.post(`${API_URL}/create-payment-intent`, {
                    amount: totalAmount,
                    currency: "usd"
                }, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                
                // X·ª≠ l√Ω thanh to√°n
                await axios.post(`${API_URL}/process-payment`, {
                    payment_intent_id: paymentResponse.data.payment_intent_id
                }, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                
                alert("Thanh to√°n th√†nh c√¥ng! ƒê∆°n h√†ng c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c x√°c nh·∫≠n.");
                showSection('orders');
                
            } catch (error) {
                console.error("L·ªói khi thanh to√°n:", error);
                alert("L·ªói khi thanh to√°n: " + (error.response?.data?.detail || "L·ªói h·ªá th·ªëng"));
            }
        }

        // --- ƒê∆†N H√ÄNG ---
        async function loadOrders() {
            if (!token) {
                alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem l·ªãch s·ª≠ ƒë∆°n h√†ng");
                showSection('login');
                return;
            }
            
            try {
                const response = await axios.get(`${API_URL}/orders`, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                
                const ordersList = document.getElementById('orders-list');
                
                if (response.data.length === 0) {
                    ordersList.innerHTML = '<p class="text-gray-500">B·∫°n ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</p>';
                    return;
                }
                
                let html = '<div class="space-y-6">';
                response.data.forEach(order => {
                    html += `
                        <div class="border rounded p-4">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="text-lg font-bold">ƒê∆°n h√†ng #${order.id}</h3>
                                <span class="px-2 py-1 rounded text-sm ${
                    order.status === 'paid' ? 'bg-green-100 text-green-800' : 
                    order.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 
                    'bg-blue-100 text-blue-800'
                }">${order.status}</span>
                            </div>
                            <p><span class="font-bold">T·ªïng ti·ªÅn:</span> $${order.total_amount}</p>
                            <p><span class="font-bold">ƒê·ªãa ch·ªâ giao h√†ng:</span> ${order.shipping_address}</p>
                            <p><span class="font-bold">Ng√†y t·∫°o:</span> ${new Date(order.created_at).toLocaleString('vi-VN')}</p>
                        </div>
                    `;
                });
                html += '</div>';
                
                ordersList.innerHTML = html;
                
            } catch (error) {
                console.error("L·ªói khi t·∫£i l·ªãch s·ª≠ ƒë∆°n h√†ng:", error);
                ordersList.innerHTML = '<p class="text-red-500">L·ªói khi t·∫£i l·ªãch s·ª≠ ƒë∆°n h√†ng</p>';
            }
        }

        // --- WISHLIST ---
        async function addToWishlist(productId, productName, productPrice) {
            if (!token) {
                alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ th√™m v√†o danh s√°ch y√™u th√≠ch");
                showSection('login');
                return;
            }
            
            try {
                await axios.post(`${API_URL}/wishlist`, {
                    product_id: productId
                }, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                
                alert("ƒê√£ th√™m v√†o danh s√°ch y√™u th√≠ch!");
            } catch (error) {
                console.error("L·ªói khi th√™m v√†o wishlist:", error);
                alert("L·ªói khi th√™m v√†o danh s√°ch y√™u th√≠ch: " + (error.response?.data?.detail || "L·ªói h·ªá th·ªëng"));
            }
        }

        async function loadWishlist() {
            if (!token) {
                return;
            }
            
            try {
                const response = await axios.get(`${API_URL}/wishlist`, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                
                const wishlistItems = document.getElementById('quick-wishlist-items');
                
                if (response.data.length === 0) {
                    document.getElementById('quick-wishlist').classList.add('hidden');
                    return;
                }
                
                let html = '<div class="space-y-2">';
                response.data.forEach(item => {
                    html += `
                        <div class="flex justify-between text-sm">
                            <span>${item.product_name}</span>
                            <span>$${item.product_price}</span>
                        </div>
                    `;
                });
                html += '</div>';
                
                wishlistItems.innerHTML = html;
                document.getElementById('quick-wishlist').classList.remove('hidden');
                
            } catch (error) {
                console.error("L·ªói khi t·∫£i danh s√°ch y√™u th√≠ch:", error);
            }
        }
    </script>
</body>
</html>